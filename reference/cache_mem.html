<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a memory cache object — cache_mem • cachem</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create a memory cache object — cache_mem" />
<meta property="og:description" content="A memory cache object is a key-value store that saves the values in an
environment. Objects can be stored and retrieved using the get() and
set() methods. Objects are automatically pruned from the cache according to
the parameters max_size, max_age, max_n, and evict." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cachem</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/cachem/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a memory cache object</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/cachem/blob/master/R/cache-memory.R'><code>R/cache-memory.R</code></a></small>
    <div class="hidden name"><code>cache_mem.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A memory cache object is a key-value store that saves the values in an
environment. Objects can be stored and retrieved using the <code><a href='https://rdrr.io/r/base/get.html'>get()</a></code> and
<code>set()</code> methods. Objects are automatically pruned from the cache according to
the parameters <code>max_size</code>, <code>max_age</code>, <code>max_n</code>, and <code>evict</code>.</p>
    </div>

    <pre class="usage"><span class='fu'>cache_mem</span><span class='op'>(</span>
  max_size <span class='op'>=</span> <span class='fl'>512</span> <span class='op'>*</span> <span class='fl'>1024</span><span class='op'>^</span><span class='fl'>2</span>,
  max_age <span class='op'>=</span> <span class='cn'>Inf</span>,
  max_n <span class='op'>=</span> <span class='cn'>Inf</span>,
  evict <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"lru"</span>, <span class='st'>"fifo"</span><span class='op'>)</span>,
  missing <span class='op'>=</span> <span class='fu'><a href='https://r-lib.github.io/fastmap/reference/key_missing.html'>key_missing</a></span><span class='op'>(</span><span class='op'>)</span>,
  logfile <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>max_size</th>
      <td><p>Maximum size of the cache, in bytes. If the cache exceeds
this size, cached objects will be removed according to the value of the
<code>evict</code>. Use <code>Inf</code> for no size limit. The default is 1 gigabyte.</p></td>
    </tr>
    <tr>
      <th>max_age</th>
      <td><p>Maximum age of files in cache before they are evicted, in
seconds. Use <code>Inf</code> for no age limit.</p></td>
    </tr>
    <tr>
      <th>max_n</th>
      <td><p>Maximum number of objects in the cache. If the number of objects
exceeds this value, then cached objects will be removed according to the
value of <code>evict</code>. Use <code>Inf</code> for no limit of number of items.</p></td>
    </tr>
    <tr>
      <th>evict</th>
      <td><p>The eviction policy to use to decide which objects are removed
when a cache pruning occurs. Currently, <code>"lru"</code> and <code>"fifo"</code> are supported.</p></td>
    </tr>
    <tr>
      <th>missing</th>
      <td><p>A value to return when <code><a href='https://rdrr.io/r/base/get.html'>get(key)</a></code> is called but the key is not
present in the cache. The default is a <code><a href='https://r-lib.github.io/fastmap/reference/key_missing.html'>key_missing()</a></code> object. It is
actually an expression that is evaluated each time there is a cache miss.
See section Missing keys for more information.</p></td>
    </tr>
    <tr>
      <th>logfile</th>
      <td><p>An optional filename or connection object to where logging
information will be written. To log to the console, use <code><a href='https://rdrr.io/r/base/showConnections.html'>stderr()</a></code> or
<code><a href='https://rdrr.io/r/base/showConnections.html'>stdout()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A memory caching object, with class <code>cache_mem</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>In a <code>cache_mem</code>, R objects are stored directly in the cache; they are not
<em>not</em> serialized before being stored in the cache. This contrasts with other
cache types, like <code><a href='cache_disk.html'>cache_disk()</a></code>, where objects are serialized, and the
serialized object is cached. This can result in some differences of behavior.
For example, as long as an object is stored in a cache_mem, it will not be
garbage collected.</p>
    <h2 class="hasAnchor" id="missing-keys"><a class="anchor" href="#missing-keys"></a>Missing keys</h2>

    


<p>The <code>missing</code> parameter controls what happens when <code><a href='https://rdrr.io/r/base/get.html'>get()</a></code> is called with a
key that is not in the cache (a cache miss). The default behavior is to
return a <code><a href='https://r-lib.github.io/fastmap/reference/key_missing.html'>key_missing()</a></code> object. This is a <em>sentinel value</em> that indicates
that the key was not present in the cache. You can test if the returned
value represents a missing key by using the <code><a href='https://r-lib.github.io/fastmap/reference/key_missing.html'>is.key_missing()</a></code> function.
You can also have <code><a href='https://rdrr.io/r/base/get.html'>get()</a></code> return a different sentinel value, like <code>NULL</code>.
If you want to throw an error on a cache miss, you can do so by providing
an expression for <code>missing</code>, as in <code>missing = stop("Missing key")</code>.</p>
<p>When the cache is created, you can supply a value for <code>missing</code>, which sets
the default value to be returned for missing values. It can also be
overridden when <code><a href='https://rdrr.io/r/base/get.html'>get()</a></code> is called, by supplying a <code>missing</code> argument. For
example, if you use <code>cache$get("mykey", missing = NULL)</code>, it will return
<code>NULL</code> if the key is not in the cache.</p>
<p>The <code>missing</code> parameter is actually an expression which is evaluated each
time there is a cache miss. A quosure (from the rlang package) can be used.</p>
<p>If you use this, the code that calls <code><a href='https://rdrr.io/r/base/get.html'>get()</a></code> should be wrapped with
<code><a href='https://rdrr.io/r/base/conditions.html'>tryCatch()</a></code> to gracefully handle missing keys.</p>
<p>@section Cache pruning:</p>
<p>Cache pruning occurs when <code>set()</code> is called, or it can be invoked manually
by calling <code>prune()</code>.</p>
<p>When a pruning occurs, if there are any objects that are older than
<code>max_age</code>, they will be removed.</p>
<p>The <code>max_size</code> and <code>max_n</code> parameters are applied to the cache as a whole,
in contrast to <code>max_age</code>, which is applied to each object individually.</p>
<p>If the number of objects in the cache exceeds <code>max_n</code>, then objects will be
removed from the cache according to the eviction policy, which is set with
the <code>evict</code> parameter. Objects will be removed so that the number of items
is <code>max_n</code>.</p>
<p>If the size of the objects in the cache exceeds <code>max_size</code>, then objects
will be removed from the cache. Objects will be removed from the cache so
that the total size remains under <code>max_size</code>. Note that the size is
calculated using the size of the files, not the size of disk space used by
the files --- these two values can differ because of files are stored in
blocks on disk. For example, if the block size is 4096 bytes, then a file
that is one byte in size will take 4096 bytes on disk.</p>
<p>Another time that objects can be removed from the cache is when <code><a href='https://rdrr.io/r/base/get.html'>get()</a></code> is
called. If the target object is older than <code>max_age</code>, it will be removed
and the cache will report it as a missing value.</p>
    <h2 class="hasAnchor" id="eviction-policies"><a class="anchor" href="#eviction-policies"></a>Eviction policies</h2>

    


<p>If <code>max_n</code> or <code>max_size</code> are used, then objects will be removed
from the cache according to an eviction policy. The available eviction
policies are:</p>
<dl>
<dt><code>"lru"</code></dt><dd><p>Least Recently Used. The least recently used objects will be removed.
This uses the filesystem's atime property. Some filesystems do not
support atime, or have a very low atime resolution. The cache_mem will
check for atime support, and if the filesystem does not support atime,
a warning will be issued and the "fifo" policy will be used instead.</p></dd>
<dt><code>"fifo"</code></dt><dd><p>First-in-first-out. The oldest objects will be removed.</p></dd>

</dl>

    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    


<p>A disk cache object has the following methods:</p>
<dl>
<dt><code><a href='https://rdrr.io/r/base/get.html'>get(key, missing)</a></code></dt><dd><p>Returns the value associated with <code>key</code>. If the key is not in the
cache, then it evaluates the expression specified by <code>missing</code> and
returns the value. If <code>missing</code> is specified here, then it will
override the default that was set when the <code>cache_mem</code> object was
created. See section Missing Keys for more information.</p></dd>
<dt><code>set(key, value)</code></dt><dd><p>Stores the <code>key</code>-<code>value</code> pair in the cache.</p></dd>
<dt><code><a href='https://rdrr.io/r/base/exists.html'>exists(key)</a></code></dt><dd><p>Returns <code>TRUE</code> if the cache contains the key, otherwise
<code>FALSE</code>.</p></dd>
<dt><code>size()</code></dt><dd><p>Returns the number of items currently in the cache.</p></dd>
<dt><code>keys()</code></dt><dd><p>Returns a character vector of all keys currently in the cache.</p></dd>
<dt><code>reset()</code></dt><dd><p>Clears all objects from the cache.</p></dd>
<dt><code>destroy()</code></dt><dd><p>Clears all objects in the cache, and removes the cache directory from
disk.</p></dd>
<dt><code>prune()</code></dt><dd><p>Prunes the cache, using the parameters specified by <code>max_size</code>,
<code>max_age</code>, <code>max_n</code>, and <code>evict</code>.</p></dd>

</dl>


  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Winston Chang,  RStudio.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


